<!--Headers-->
<header th:insert="fragments/header.html"> </header>
<!--Navbars-->
<span th:insert="fragments/navbar.html"> </span>

<!--Content-->


<div class="container-fluid mx-auto px-5 py-4">
    <h1>Create Warehouse</h1>
    <form th:object="${ware}" th:action="@{/warehouse/create}" method="post" class="row g-3">
        <div class="mb-3 col-md-6">
            <label for="warehouseNo" class="form-label">Warehouse Id</label>
            <input type="text" class="form-control" id="warehouseNo" aria-describedby="warehouseNoHelp"
                   th:field="*{wareNo}"/>
            <div id="warehouseNoHelp" class="form-text">Should be unique</div>
            <span th:if="${#fields.hasErrors('wareNo')}" th:errors="*{wareNo}" class="text-danger">error</span>
        </div>

        <div class="mb-3 col-md-6">
            <label for="wareName" class="form-label">Name</label>
            <input class="form-control" id="wareName" th:field="*{name}"/>
            <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-danger">error</span>
        </div>
        <div class="mb-3 col-md-12">
            <label for="autocompleteLoc" class="form-label">Location</label>
            <input class="form-control" id="autocompleteLoc"/>
            <span th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="text-danger">error</span>

            <input type="hidden" class="form-control" th:field="*{address}" id="formatted_address">
            <input type="hidden" class="form-control" th:field="*{street_number}" id="street_number">
            <input type="hidden" class="form-control" th:field="*{city}" id="locality">
            <input type="hidden" class="form-control" th:field="*{state}" id="administrative_area_level_1">
            <input type="hidden" class="form-control" th:field="*{country}" id="country">
            <input type="hidden" class="form-control" th:field="*{postal_code}" id="postal_code">
            <input type="hidden" class="form-control" th:field="*{lat}" id="lat">
            <input type="hidden" class="form-control" th:field="*{lng}" id="lng">
        </div>
        <h3>Capacity</h3>
        <div class="mb-3 col-md-4">
            <label for="aisle" class="form-label">Aisles</label>
            <input class="form-control" id="aisle" th:field="*{aisle}"/>
            <span th:if="${#fields.hasErrors('aisle')}" th:errors="*{aisle}" class="text-danger">error</span>
        </div>
        <div class="mb-3 col-md-4">
            <label for="section" class="form-label">Sections</label>
            <input class="form-control" id="section" th:field="*{section}"/>
            <span th:if="${#fields.hasErrors('section')}" th:errors="*{section}" class="text-danger">error</span>
        </div>
        <div class="mb-3 col-md-4">
            <label for="level" class="form-label">Levels</label>
            <input class="form-control" id="level" th:field="*{level}"/>
            <span th:if="${#fields.hasErrors('level')}" th:errors="*{level}" class="text-danger">error</span>
        </div>
        <button type="submit" class="btn btn-primary">Create</button>
    </form>
</div>

<!-- Places API -->
<script th:attr="src=@{|https://maps.googleapis.com/maps/api/js?key=${googleApiKey}&libraries=places|}">
</script>

<script type="text/javascript">
    window.addEventListener('load', initAutocomplete);

    /**
     * Add autocomplete feature to address bar
     */
    function initAutocomplete() {
        const options = {
            componentRestrictions: { country: ["ca", "us"] },
            fields: ["formatted_address", "address_components", "geometry"],
            strictBounds: false,
        };
        const autocompleteInput = document.getElementById('autocompleteLoc')
        let places = new google.maps.places.Autocomplete(autocompleteInput, options);
        google.maps.event.addListener(places, 'place_changed', function () {
            let place = places.getPlace();
            fillValues(place)
        });
    }

    /**
     * Fills the required fields in the address
     * @param place: the google map api response for the entered address
     */
    function fillValues(place) {
        let components = {}
        for (let c of place.address_components) {
            for (let t of c.types) {
                components[t] = c.long_name;
            }
        }
        components['lat'] = place.geometry.location.lat().toFixed(2);
        components['lng'] = place.geometry.location.lng().toFixed(2);
        components['formatted_address'] = place.formatted_address;
        let inputIds = ['formatted_address', 'street_number', 'locality', 'administrative_area_level_1', 'postal_code', 'country', 'lat', 'lng']
        for (let it of inputIds) {
            if (it in components) {
                let field = document.getElementById(it)
                field.value = components[it];
            }
        }
    }
</script>

<!--Footer-->
<span th:insert="fragments/footer.html"> </span>